<li
  class="relative flex flex-col bg-background-meta rounded-sm p-5 border border-border-medium w-full"
>
  <div class="flex items-center justify-between gap-3">
    <!--============== Rating & Author ==============-->
    <div class="flex items-center gap-2">
      <!--============== Rating ==============-->
      <small class="flex items-center gap-1 text-lg">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="lucide lucide-star-icon lucide-star fill-mustard stroke-mustard"
        >
          <path
            d="M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z"
          />
        </svg>

        <span class="text-lg">{{review().rating}}</span>
      </small>

      <!--============== Author ==============-->
      <span
        class="text-lg xl:text-xl font-medium text-mustard line-clamp-1 truncate"
      >
        {{review().user.name}}
      </span>
    </div>

    <!--============== Actions ==============-->
    @if (user() && review().userId === user()?.id) {
    <div class="flex items-center gap-2">
      <button
        class="grid place-items-center p-1 border border-mustard rounded-sm transition-colors duration-200 ease-in-out hover:bg-mustard hover:text-bg-darker"
        aria-label="Edit Review"
        (click)="toggleReviewForm()"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="lucide lucide-pencil-icon lucide-pencil"
        >
          <path
            d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"
          />
          <path d="m15 5 4 4" />
        </svg>
      </button>

      <button
        class="grid place-items-center p-1 border border-mustard rounded-sm transition-colors duration-200 ease-in-out hover:bg-mustard hover:text-bg-darker"
        aria-label="Delete Review"
        (click)="deleteReview(plant().id)"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="lucide lucide-trash-icon lucide-trash"
        >
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6" />
          <path d="M3 6h18" />
          <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
        </svg>
      </button>
    </div>
    }
  </div>

  <!--============== Commnent ==============-->
  @if (review().comment) {
  <p class="text-sm md:text-lg text-text tracking-wide line-clamp-4 mt-2">
    {{review().comment}}
  </p>
  }

  <!--==============  Update Review Form ==============-->
  @if (user() && review().userId === user()?.id) {
  <form
    class="absolute text-center flex flex-col gap-3 p-5 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-text text-bg rounded-sm w-full z-30 max-w-125 shadow-sm shadow-mustard transition-transform duration-200 ease-in-out"
    [ngClass]="isUpdateReviewOpen() ? 'scale-105 visible opacity-100' : 'scale-0 hidden opacity-0 pointer-events-none'"
    (submit)="updateReview($event, plant().id)"
  >
    <!--============== Heading ==============-->
    <h3
      class="text-3xl md:text-4xl xl:text-5xl font-secondary font-bold text-bg-contrast mb-3.5"
    >
      Update Review
    </h3>

    <!--============== Input Fields ==============-->
    <input
      type="number"
      [formControl]="rating"
      min="1"
      max="5"
      inputmode="numeric"
      placeholder="Rating (1-5 stars)"
      class="flex bg-bg text-text py-3 px-4 rounded-sm border border-mustard outline-none focus:ring-2 focus:ring-mustard focus:ring-offset-2"
      name="rating"
      id="rating"
      required
    />

    <textarea
      [formControl]="message"
      name="message"
      id="message"
      placeholder="Your Message..."
      cols="30"
      rows="5"
      class="bg-bg text-text border border-mustard rounded-sm p-3 resize-none overflow-y-auto outline-none focus:ring-2 focus:ring-mustard focus:ring-offset-2"
    ></textarea>

    <!--============== Errors ==============-->
    <!-- Backend Error -->
    @if(this.isFormSubmitted() && rating.valid && message.valid && errorState())
    {
    <small class="error-state"> {{errorState()}} </small>
    }

    <!-- Rating Error -->
    @if((rating.dirty || isFormSubmitted()) && rating.invalid) {
    <small class="error-state"> {{getRatingErrors()}} </small>
    }

    <!-- Message Error -->
    @if((message.dirty || isFormSubmitted()) && message.invalid) {
    <small class="error-state"> {{getMessageErrors()}} </small>
    }

    <!--============== Actions ==============-->
    <div class="flex items-center justify-between gap-2 mt-1.5">
      <button
        type="submit"
        class="inline-block items-center justify-center text-lg rounded-sm py-2 px-4 bg-mustard text-bg-darker w-full transition-colors duration-200 ease-in-out hover:bg-mustard/90"
        [disabled]="!rating.valid || !message.valid || isLoading()"
        [attr.aria.disabled]="!rating.valid || !message.valid || isLoading()"
        [attr.aria-busy]="isLoading()"
      >
        @if(isLoading()) {
        <span aria-label="Loading Spinner" aria-live="polite">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="26"
            height="26"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-loader-circle-icon lucide-loader-circle text-bg-darker place-self-center transition-transform duration-200 ease-in-out animate-spin"
          >
            <path d="M21 12a9 9 0 1 1-6.219-8.56" />
          </svg>
        </span>
        } @else { Update }
      </button>

      <button
        type="button"
        class="inline-block items-center justify-center text-lg rounded-sm py-2 px-4 bg-red-600 text-text w-full transition-colors duration-200 ease-in-out hover:bg-red-700"
        (click)="toggleReviewForm()"
      >
        Cancel
      </button>
    </div>
  </form>
  }
</li>
